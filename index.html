<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>OLA AR</title>

  <style>
    body { margin: 0; overflow: hidden; }
    #arButton {
      position: fixed;
      left: 50%;
      bottom: 25px;
      transform: translateX(-50%);
      padding: 14px 20px;
      border: none;
      background: #ff1e1e;
      color: #fff;
      font-size: 18px;
      border-radius: 8px;
      z-index: 20;
    }
  </style>

  <!-- THREE -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
  <!-- GLTF LOADER -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/examples/js/loaders/GLTFLoader.js"></script>
</head>

<body>

<button id="arButton">AR Modunu Aç</button>

<script>
  let camera, scene, renderer, model, hitTestSource = null, localSpace;

  async function init() {

    // XR destek kontrolü
    if (!navigator.xr) {
      alert("Cihazın WebXR desteklemiyor!");
      return;
    }

    const supported = await navigator.xr.isSessionSupported("immersive-ar");
    if (!supported) {
      alert("Bu cihazda AR desteklenmiyor.");
      return;
    }

    // Renderer
    renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);

    // Scene
    scene = new THREE.Scene();

    // Camera
    camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.01, 20);

    // Model yükle
    const loader = new THREE.GLTFLoader();
    loader.load("ola.glb", (gltf) => {
      model = gltf.scene;
      model.visible = false;
      model.scale.set(0.4, 0.4, 0.4);
      scene.add(model);
    });
  }

  async function activateAR() {
    const session = await navigator.xr.requestSession("immersive-ar", {
      requiredFeatures: ["hit-test", "local"]
    });

    renderer.xr.setSession(session);

    const viewerSpace = await session.requestReferenceSpace("viewer");
    hitTestSource = await session.requestHitTestSource({ space: viewerSpace });

    localSpace = await session.requestReferenceSpace("local");

    renderer.setAnimationLoop((timestamp, frame) => {

      if (frame && hitTestSource) {
        const hits = frame.getHitTestResults(hitTestSource);
        if (hits.length > 0 && model) {
          const pose = hits[0].getPose(localSpace);

          model.visible = true;
          model.position.set(
            pose.transform.position.x,
            pose.transform.position.y,
            pose.transform.position.z
          );
          model.quaternion.set(
            pose.transform.orientation.x,
            pose.transform.orientation.y,
            pose.transform.orientation.z,
            pose.transform.orientation.w
          );
        }
      }

      renderer.render(scene, camera);
    });
  }

  document.getElementById("arButton").addEventListener("click", activateAR);

  init();
</script>

</body>
</html>
